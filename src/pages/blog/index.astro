---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import {getCollection} from 'astro:content';

// Load and sort posts (newest first)
const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Tiny helper to estimate reading time (~200wpm)
const getReadingTime = (content?: string) => {
	const words = content?.trim().split(/\s+/).length ?? 0;
	const minutes = Math.max(1, Math.round(words / 200));
	return `${minutes} min read`;
};
---

<Layout
	title='Blog'
	description='Articles and notes by Ernesto on data, AI, software, and more.'
>
	<!-- Top navigation matching home layout -->
	<div class='w-full bg-gray-900 px-4 sm:px-6 md:px-8'>
		<div class='max-w-7xl mx-auto'>
			<Header />
		</div>
	</div>

	<main class='w-full'>
		<div class='max-w-7xl mx-auto bg-gray-900 px-4 sm:px-6 md:px-8'>
			<!-- Page title -->
			<h1
				class='text-7xl sm:text-8xl md:text-9xl font-space-grotesk font-black uppercase tracking-tighter leading-none mt-6 sm:mt-8 md:mt-10'
			>
				Blog
			</h1>

			<!-- Grid of posts -->
			<section class='mt-10 md:mt-12 lg:mt-16'>
				<div class='grid grid-cols-1 md:grid-cols-2 gap-12 md:gap-14'>
					{
						posts.map((post) => {
							const minutes = getReadingTime(post.body);
							const href = `/blog/${post.id}/`;
							return (
								<article class='flex flex-col justify-between border-t-2 border-cyan-300/60 pt-6'>
									<div class='space-y-3'>
										<a href={href} class='group no-underline'>
											<h2 class='text-2xl sm:text-3xl md:text-4xl font-space-grotesk font-extrabold uppercase tracking-tight text-white group-hover:text-cyan-200 transition-colors'>
												{post.data.title}
											</h2>
										</a>
										<p class='text-xs sm:text-sm text-emerald-300 uppercase tracking-widest'>
											<span class='align-middle'>
												<FormattedDate date={post.data.pubDate} />
											</span>
											<span class='mx-2'>â€¢</span>
											<span>{minutes}</span>
										</p>
										{post.data.description && (
											<p class='text-cyan-100/90 leading-relaxed'>
												{post.data.description}
											</p>
										)}
									</div>

									<div class='mt-6'>
										<a
											href={href}
											class='relative inline-flex items-center px-5 py-2.5 text-purple-300 border-2 border-purple-400 font-medium rounded-none shadow-[6px_6px_0_0_#7c3aed] hover:shadow-[3px_3px_0_0] shadow-purple-400 transition duration-75 hover:bg-purple-400 hover:text-gray-900 no-underline'
											aria-label={`Read more: ${post.data.title}`}
										>
											Read more
										</a>
									</div>
								</article>
							);
						})
					}
				</div>
			</section>
		</div>
	</main>
</Layout>
