---
import {getCollection} from 'astro:content';

// Legacy route: redirect canonical id to /blog/:lang/:canonical
export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((p) => ({
		params: {slug: p.id},
		props: {post: p},
	}));
}

const {post} = Astro.props as any;
const lang = post.data.lang ?? 'en';
const canonical = post.data.canonicalSlug ?? post.id;
const target = `/blog/${lang}/${canonical}/`;
---

<html lang={lang}>
	<head>
		<meta http-equiv='refresh' content={`0; url=${target}`} />
		<link rel='canonical' href={target} />
		<title>Redirectingâ€¦</title>
	</head>
	<body>
		<p>Redirecting to <a href={target}>{target}</a></p>
	</body>
</html>
